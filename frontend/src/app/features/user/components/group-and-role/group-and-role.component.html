<p-toast></p-toast>
<div class="card">
  <p-tabView orientation="left">
    <p-tabPanel header="Gestionar Roles" class="line-height-3 m-0">
      <p-confirmDialog header="Confirmation" key="confirmDeleteUser" icon="pi pi-exclamation-triangle" message="'¿Estás seguro de que deseas eliminar este usuario? Esta acción no se puede deshacer.'"
                       [style]="{width: '350px'}" acceptButtonStyleClass="p-button-primary" rejectButtonStyleClass="p-button-text"></p-confirmDialog>

        <div class="text-900 font-medium text-xl mb-3">Asignar Roles a Usuarios</div>
      <div class="grid p-fluid">
        <div class="col-12 lg:col-6 md:col-6">
          <p-dropdown [options]="userItems" [(ngModel)]="selectedUser" placeholder="Seleccione un usuario" [showClear]="true" (onChange)="onSelectUser($event)" (onClear)="onClearUser()" [filter]="true"></p-dropdown>
        </div>
        <div class="col-12 lg:col-6">
          <button pButton pRipple label="Crear Usuario" class="w-auto p-button-outlined mr-3 mb-3" icon="pi pi-user-plus" [routerLink]="['/users/create']" *ngIf="selectedUserId==0"></button>
          <button pButton pRipple label="Editar Usuario" class="w-auto p-button-outlined mr-3 mb-3 p-button-secondary" icon="pi pi-user-plus" [routerLink]="['/users/edit/', selectedUserId]" *ngIf="selectedUserId!=0"></button>
          <button pButton pRipple label="Eliminar Usuario" class="w-auto p-button-outlined mb-3 p-button-secondary" icon="pi pi-user-minus" (click)="onDeleteUser()" *ngIf="selectedUserId!=0"></button>
        </div>
      </div>

      <p-pickList [source]="sourceGroups" [target]="targetGroups" sourceHeader="Roles Disponibles" targetHeader="Roles Asignados"
                  [responsive]="true" [sourceStyle]="{'height':'250px'}" [targetStyle]="{'height':'250px'}" [showSourceControls]="false" [showTargetControls]="false" [disabled]="isPickListDisabled"
                  (onMoveAllToSource)="sortSourceGroups()" (onMoveAllToTarget)="sortTargetGroups()" (onMoveToSource)="sortSourceGroups()" (onMoveToTarget)="sortTargetGroups()">
            <ng-template let-groups pTemplate="item">
              <div>{{groups.name}}</div>
            </ng-template>
          </p-pickList>
      <button pButton pRipple label="Guardar" class="w-auto p-button mt-3" icon="pi pi-save" (click)="saveUserGroups()"></button>
    </p-tabPanel>
    <p-tabPanel header="Gestionar Permisos" class="line-height-3 m-0">
      <p-confirmDialog header="Confirmation" key="confirmDeleteGroup" icon="pi pi-exclamation-triangle" message="'¿Estás seguro de que deseas eliminar este rol? Esta acción no se puede deshacer.'"
                       [style]="{width: '350px'}" acceptButtonStyleClass="p-button-primary" rejectButtonStyleClass="p-button-text"></p-confirmDialog>
      <div class="text-900 font-medium text-xl mb-3">Asignar Permisos a Roles</div>
      <div class="grid p-fluid">
        <div class="col-12 lg:col-6 md:col-6">
          <p-dropdown [options]="groupItems" [(ngModel)]="selectedGroup" placeholder="Seleccione un rol" [showClear]="true" (onChange)="onSelectRole($event)" (onClear)="onClearGroup()" [filter]="true"></p-dropdown>
        </div>
        <div class="col-12 lg:col-6">
          <button pButton pRipple label="Crear Rol" class="w-auto p-button-outlined mr-3 mb-3" icon="pi pi-plus" (click)="onAddGroup()" *ngIf="selectedGroupId==0"></button>
          <button pButton pRipple label="Editar Rol" class="w-auto p-button-outlined mr-3 mb-3 p-button-secondary" icon="pi pi-user-plus" (click)="onEditGroup()" *ngIf="selectedGroupId!=0"></button>
          <button pButton pRipple label="Eliminar Rol" class="w-auto p-button-outlined mb-3 p-button-secondary" icon="pi pi-minus" (click)="onDeleteGroup()" *ngIf="selectedGroupId!=0"></button>
        </div>
      </div>

      <p-pickList [source]="sourceRoles" [target]="targetRoles" sourceHeader="Permisos Disponibles" targetHeader="Permisos Asignados"
                  [responsive]="true" [sourceStyle]="{'height':'250px'}" [targetStyle]="{'height':'250px'}" [showSourceControls]="false" [showTargetControls]="false" [disabled]="isPickListDisabled"
                  (onMoveAllToSource)="sortSourceRoles()" (onMoveAllToTarget)="sortTargetRoles()" (onMoveToSource)="sortSourceRoles()" (onMoveToTarget)="sortTargetRoles()">
            <ng-template let-permissions pTemplate="item">
              <div>{{permissions.name}}</div>
            </ng-template>
          </p-pickList>
      <button pButton pRipple label="Guardar" class="w-auto p-button mt-3" icon="pi pi-save" (click)="saveGroupRoles()"></button>
    </p-tabPanel>
  </p-tabView>
  </div>

<p-dialog header="Crear Nuevo Rol" [(visible)]="visibleAddGroup" [modal]="true" [resizable]="false" showEffect="fade">
  <div class="flex flex-column">

          <div class="field col-12 p-0">
            <label for="roleName" class="font-medium text-900">Nombre del Rol</label>
            <input id="roleName" type="text" pInputText placeholder="Nombre del Rol" class="w-full" [formControl]="groupNameControl">
          </div>
        <div class="field col-12 p-0">
          <label for="roleDescription" class="font-medium text-900">Descripción del Rol</label>
          <textarea id="roleDescription" type="text" pInputTextarea rows="3"  placeholder="Descripción del Rol" [autoResize]="true" class="w-full h-5rem" [formControl]="groupDescriptionControl"></textarea>
        </div>

    <div class="flex flex-wrap gap-2 justify-content-between">
      <button pButton pRipple label="Cancelar" class="flex-auto p-button-outlined" (click)="visibleAddGroup = false"></button>
      <button pButton pRipple label="Guardar" class="flex-auto" (click)="onSaveGroup()"></button>
    </div>
  </div>
</p-dialog>

<p-dialog header="Editar Rol" [(visible)]="visibleEditGroup" [modal]="true" [resizable]="false" showEffect="fade">
  <div class="flex flex-column">

    <div class="field col-12 p-0">
      <label for="newRoleName" class="font-medium text-900">Nombre del Rol</label>
      <input id="newRoleName" type="text" pInputText placeholder="Nombre del Rol" class="w-full" [formControl]="groupNameControl">
    </div>
    <div class="field col-12 p-0">
      <label for="newRoleDescription" class="font-medium text-900">Descripción del Rol</label>
      <textarea id="newRoleDescription" type="text" pInputTextarea rows="3"  placeholder="Descripción del Rol" [autoResize]="true" class="w-full h-5rem" [formControl]="groupDescriptionControl"></textarea>
    </div>

    <div class="flex flex-wrap gap-2 justify-content-between">
      <button pButton pRipple label="Cancelar" class="flex-auto p-button-outlined" (click)="visibleEditGroup = false"></button>
      <button pButton pRipple label="Guardar" class="flex-auto" (click)="onUpdateGroup()"></button>
    </div>
  </div>
</p-dialog>
