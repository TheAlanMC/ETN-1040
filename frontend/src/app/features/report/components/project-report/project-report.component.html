<p-toast></p-toast>

<div id="executiveReportContent">
    <div class="card">
        <span class="text-900 text-xl font-bold mb-4 block">Reporte de Proyectos</span>
        <div class="grid p-fluid">
            <div class="col-12 lg:col-4">
                <p-calendar [disabled]="generatedReport" [formControl]="dateFromControl"
                            [readonlyInput]="true" [showIcon]="true" dateFormat="dd/mm/yy"
                            id="dateFrom" placeholder="Fecha de Inicio"></p-calendar>
            </div>
            <div class="col-12 lg:col-4">
                <p-calendar [disabled]="generatedReport" [formControl]="dateToControl"
                            [readonlyInput]="true" [showIcon]="true" dateFormat="dd/mm/yy"
                            id="dateTo" placeholder="Fecha de Finalización"></p-calendar>
            </div>
            <div *ngIf="!generatedReport" class="col-12 lg:col-4">
                <button (click)="onSync()" [disabled]="dateFromControl.invalid || dateToControl.invalid" [loading]="isDataLoading"
                        class="p-button p-button-primary" icon="pi pi-sync" label="Generar Reporte"
                        pButton
                ></button>
            </div>
            <div *ngIf="generatedReport" class="col-12 lg:col-2">
                <button (click)="onExportPdf()" [disabled]="dateFromControl.invalid || dateToControl.invalid" [loading]="isLoading"
                        class="p-button p-button-primary" icon="pi pi-file-pdf" label="Exportar"
                        pButton
                ></button>
            </div>

            <div *ngIf="generatedReport" class="col-12 lg:col-2">
                <button (click)="onClear()" [loadingIcon]="'pi pi-times'" [loading]="isLoading" class="p-button p-button-secondary" icon="pi pi-times"
                        label="Limpiar" pButton
                ></button>
            </div>
        </div>


        <p-table (onPage)="onPageChange($event)" (onSort)="onSortChange($event)" [customSort]="true" [lazy]="true"
                 [loading]="isDataLoading"
                 [paginator]="true" [rowsPerPageOptions]="[5, 10, 25]" [rows]="10" [showCurrentPageReport]="true"
                 [totalRecords]="totalElements" [value]="projects"
                 currentPageReportTemplate="Mostrando registros {first}-{last} de {totalRecords}">
            <ng-template pTemplate="caption">
                <div *ngIf="generatedReport" class="grid p-fluid">
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onStatusChange($event)" [(ngModel)]="selectedStatuses"
                                       [filter]="false"
                                       [options]="statusItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Estado"
                        >
                        </p-multiSelect>
                    </div>
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onOwnerChange($event)" [(ngModel)]="selectedOwners"
                                       [filter]="true"
                                       [options]="ownerItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Propietario">
                        </p-multiSelect>
                    </div>
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onModeratorChange($event)" [(ngModel)]="selectedModerators"
                                       [filter]="true"
                                       [options]="moderatorItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Moderador">
                        </p-multiSelect>
                    </div>
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onMemberChange($event)" [(ngModel)]="selectedMembers"
                                       [filter]="true"
                                       [options]="memberItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Prioridad">
                        </p-multiSelect>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th class="white-space-nowrap" pSortableColumn="projectName">Nombre del Proyecto
                        <p-sortIcon field="projectName"/>
                    </th>
                    <th class="white-space-nowrap">Estado del Proyecto</th>
                    <th class="white-space-nowrap">Progreso de Tareas</th>
                    <th class="white-space-nowrap" pSortableColumn="projectDateFrom">Fecha de Inicio
                        <p-sortIcon field="project.projectDateFrom"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="projectDateTo">Fecha de Finalización
                        <p-sortIcon field="project.projectDateTo"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="projectEndDate">Fecha de Cierre
                        <p-sortIcon field="projectEndDate"/>
                    </th>
                </tr>
            </ng-template>
            <ng-template let-project pTemplate="body">
                <tr>
                    <td class="white-space-nowrap">{{ project.projectName }}</td>
                    <td class="white-space-nowrap">{{ project.projectStatusName }}</td>
                    <td class="white-space-nowrap">
                        <p-progressBar [showValue]="false"
                                       [style]="{'height': '1.5rem'}"
                                       [value]="(project.projectFinishedTasks/project.projectTotalTasks) == 0 ? 20 : (project.projectFinishedTasks/project.projectTotalTasks)*100">
                            <ng-template pTemplate="content">
                                <span>{{ project.projectFinishedTasks }}/{{ project.projectTotalTasks }}</span>
                            </ng-template>
                        </p-progressBar>
                    </td>
                    <td class="white-space-nowrap">{{ project.projectDateFrom | date: 'dd/MM/yyyy' }}</td>
                    <td class="white-space-nowrap">{{ project.projectDateTo | date: 'dd/MM/yyyy' }}</td>
                    <td *ngIf="project.projectEndDate" class="white-space-nowrap">{{ project.projectEndDate | date: 'dd/MM/yyyy' }}</td>
                    <td *ngIf="!project.projectEndDate" class="white-space-nowrap">En Progreso</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">
                        <div class="flex justify-content-center align-items-center gap-2">
                            <i class="pi pi-info-circle p-mr-2"></i>
                            <span>No se encontraron registros</span>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</div>


