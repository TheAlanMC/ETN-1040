<p-toast></p-toast>

<div id="executiveReportContent">
    <div class="card">
        <span class="text-900 text-xl font-bold mb-4 block">Reporte de Tareas</span>
        <div class="grid p-fluid">
            <div class="col-12 lg:col-4">
                <p-calendar [disabled]="generatedReport" [formControl]="dateFromControl"
                            [readonlyInput]="true" [showIcon]="true" dateFormat="dd/mm/yy"
                            id="dateFrom" placeholder="Fecha de Inicio"></p-calendar>
            </div>
            <div class="col-12 lg:col-4">
                <p-calendar [disabled]="generatedReport" [formControl]="dateToControl"
                            [readonlyInput]="true" [showIcon]="true" dateFormat="dd/mm/yy"
                            id="dateTo" placeholder="Fecha de Finalización"></p-calendar>
            </div>
            <div *ngIf="!generatedReport" class="col-12 lg:col-4">
                <button (click)="onSync()" [disabled]="dateFromControl.invalid || dateToControl.invalid" [loading]="isDataLoading"
                        class="p-button p-button-primary" icon="pi pi-sync" label="Generar Reporte"
                        pButton
                ></button>
            </div>
            <div *ngIf="generatedReport" class="col-12 lg:col-2">
                <button (click)="onExportPdf()" [disabled]="dateFromControl.invalid || dateToControl.invalid" [loading]="isLoading"
                        class="p-button p-button-primary" icon="pi pi-file-pdf" label="Exportar"
                        pButton
                ></button>
            </div>

            <div *ngIf="generatedReport" class="col-12 lg:col-2">
                <button (click)="onClear()" [loadingIcon]="'pi pi-times'" [loading]="isLoading" class="p-button p-button-secondary" icon="pi pi-times"
                        label="Limpiar" pButton
                ></button>
            </div>
        </div>


        <p-table (onPage)="onPageChange($event)" (onSort)="onSortChange($event)" [customSort]="true" [lazy]="true"
                 [loading]="isDataLoading"
                 [paginator]="true" [rowsPerPageOptions]="[5, 10, 25]" [rows]="10" [showCurrentPageReport]="true"
                 [totalRecords]="totalElements" [value]="tasks"
                 currentPageReportTemplate="Mostrando registros {first}-{last} de {totalRecords}">
            <ng-template pTemplate="caption">
                <div class="grid p-fluid" *ngIf="generatedReport">
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onStatusChange($event)" [(ngModel)]="selectedStatuses"
                                       [filter]="false"
                                       [options]="statusItems"
                                       class="multiselect-custom"  optionLabel="label"
                                       placeholder="Seleccionar Estado">
                        </p-multiSelect>
                    </div>
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onPriorityChange($event)" [(ngModel)]="selectedPriorities"
                                       [filter]="false"
                                       [options]="priorityItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Prioridad">
                        </p-multiSelect>
                    </div>
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onProjectChange($event)" [(ngModel)]="selectedProjects"
                                       [filter]="true"
                                       [options]="projectItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Proyecto">
                        </p-multiSelect>
                    </div>
                    <div class="col-12 lg:col-6">
                        <p-multiSelect (onChange)="onAssigneeChange($event)" [(ngModel)]="selectedAssignees"
                                       [filter]="true"
                                       [options]="assigneeItems"
                                       class="multiselect-custom" optionLabel="label"
                                       placeholder="Seleccionar Responsable">
                        </p-multiSelect>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th class="white-space-nowrap" pSortableColumn="taskName">Nombre de la Tarea
                        <p-sortIcon field="taskName"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="taskStatusId">Estado de la Tarea
                        <p-sortIcon field="taskStatusId"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="taskPriorityId">Prioridad de la Tarea
                        <p-sortIcon field="taskPriorityId"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="txDate">Fecha de Creación
                        <p-sortIcon field="txDate"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="taskDueDate">Fecha Límite
                        <p-sortIcon field="taskDueDate"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="taskEndDate">Fecha de Finalización
                        <p-sortIcon field="taskEndDate"/>
                    </th>
                    <th class="white-space-nowrap" pSortableColumn="taskRating">Calificación
                        <p-sortIcon field="taskRating"/>
                    </th>
                </tr>
            </ng-template>
            <ng-template let-task pTemplate="body">
                <tr>
                <tr>
                    <td class="white-space-nowrap">{{ task.taskName }}</td>
                    <td class="white-space-nowrap">{{ task.taskStatusName }}</td>
                    <td class="white-space-nowrap">{{ task.taskPriorityName }}</td>
                    <td class="white-space-nowrap">{{ task.taskCreationDate | date: 'dd/MM/yyyy, HH:mm' }}</td>
                    <td class="white-space-nowrap">{{ task.taskDueDate | date: 'dd/MM/yyyy, HH:mm' }}</td>
                    <td *ngIf="task.taskEndDate" class="white-space-nowrap">{{ task.taskEndDate | date: 'dd/MM/yyyy, HH:mm' }}
                    </td>
                    <td *ngIf="!task.taskEndDate" class="white-space-nowrap">En Progreso</td>
                    <td class="white-space-nowrap">
                        <p-rating [cancel]="false" [disabled]="true" [iconOffStyle]="{'fontSize':'12px'}"
                                  [iconOnStyle]="{'fontSize':'12px'}"
                                  [ngModel]="task.taskRating" [readonly]="true"></p-rating>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">
                        <div class="flex justify-content-center align-items-center gap-2">
                            <i class="pi pi-info-circle p-mr-2"></i>
                            <span>No se encontraron registros</span>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</div>


